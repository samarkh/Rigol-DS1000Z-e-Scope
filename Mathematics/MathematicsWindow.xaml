<Window x:Class="DS1000Z_E_USB_Control.Mathematics.MathematicsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:local="clr-namespace:DS1000Z_E_USB_Control.Mathematics"
        mc:Ignorable="d"
        Title="Mathematics Functions - Rigol DS1000Z-E" 
        Height="1000" Width="1100"
        MinHeight="600" MinWidth="900"
        WindowStartupLocation="CenterScreen"
        WindowState="Normal"
        ResizeMode="CanResize">

    <!-- #region Window Resources -->
    <Window.Resources>
        <!-- Menu Button Style -->
        <Style x:Key="MenuButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#455A64"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="Margin" Value="5,0"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#546E7A"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#37474F"/>
                </Trigger>
                <Trigger Property="IsEnabled" Value="False">
                    <Setter Property="Background" Value="#BDBDBD"/>
                    <Setter Property="Foreground" Value="#757575"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Status Bar Style -->
        <Style x:Key="StatusBarStyle" TargetType="StatusBar">
            <Setter Property="Background" Value="#37474F"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="BorderBrush" Value="#263238"/>
            <Setter Property="BorderThickness" Value="0,2,0,0"/>
        </Style>

        <!-- Header Style -->
        <Style x:Key="HeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!-- Separator Style -->
        <Style x:Key="SeparatorStyle" TargetType="Separator">
            <Setter Property="Background" Value="#546E7A"/>
            <Setter Property="Margin" Value="10,0"/>
            <Setter Property="Width" Value="2"/>
        </Style>

        <!-- Status Text Style -->
        <Style x:Key="StatusTextStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>

        <!-- Timestamp Text Style -->
        <Style x:Key="TimestampStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#B0BEC5"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="HorizontalAlignment" Value="Right"/>
            <Setter Property="FontFamily" Value="Consolas"/>
        </Style>
    </Window.Resources>
    <!-- #endregion -->

    <!-- #region Main Window Layout -->
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Menu Bar -->
            <RowDefinition Height="*"/>
            <!-- Main Content -->
            <RowDefinition Height="Auto"/>
            <!-- Status Bar -->
        </Grid.RowDefinitions>

        <!-- #region Menu Bar -->
        <Border Grid.Row="0" Background="#37474F" BorderBrush="#263238" BorderThickness="0,0,0,2">
            <Grid Height="50">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <!-- Title -->
                    <ColumnDefinition Width="*"/>
                    <!-- Spacer -->
                    <ColumnDefinition Width="Auto"/>
                    <!-- Menu Buttons -->
                </Grid.ColumnDefinitions>

                <!-- Window Title and Icon -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="15,0" VerticalAlignment="Center">
                    <TextBlock Text="🧮" FontSize="20" Margin="0,0,10,0" VerticalAlignment="Center"/>
                    <TextBlock Text="Mathematics Functions" Style="{StaticResource HeaderStyle}"/>
                    <TextBlock Text="- Rigol DS1000Z-E" FontSize="12" Foreground="#B0BEC5" 
                               Margin="8,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Menu Action Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="10,0,15,0" VerticalAlignment="Center">

                    <!-- Configuration Management -->
                    <Button Content="🔄 Reset All" 
                            Style="{StaticResource MenuButtonStyle}"
                            Click="ResetAll_Click"
                            ToolTip="Reset all mathematics settings to factory defaults"/>

                    <Button Content="💾 Save Config" 
                            Style="{StaticResource MenuButtonStyle}"
                            Click="SaveConfig_Click"
                            ToolTip="Save current mathematics configuration to file"/>

                    <Button Content="📁 Load Config" 
                            Style="{StaticResource MenuButtonStyle}"
                            Click="LoadConfig_Click"
                            ToolTip="Load mathematics configuration from file"/>

                    <Separator Style="{StaticResource SeparatorStyle}"/>

                    <!-- Preset Management -->
                    <Button Content="⚡ Presets" 
                            Style="{StaticResource MenuButtonStyle}"
                            Click="ShowPresets_Click"
                            ToolTip="Apply predefined mathematics configurations"/>

                    <Button Content="📊 Templates" 
                            Style="{StaticResource MenuButtonStyle}"
                            Click="ShowTemplates_Click"
                            ToolTip="Load mathematics function templates"/>

                    <Separator Style="{StaticResource SeparatorStyle}"/>

                    <!-- Utility Functions -->
                    <Button Content="🔍 Validate" 
                            Style="{StaticResource MenuButtonStyle}"
                            Click="ValidateConfig_Click"
                            ToolTip="Validate current mathematics configuration"/>

                    <Button Content="📋 Export Commands" 
                            Style="{StaticResource MenuButtonStyle}"
                            Click="ExportCommands_Click"
                            ToolTip="Export SCPI commands to text file"/>

                    <Separator Style="{StaticResource SeparatorStyle}"/>

                    <!-- Help and Information -->
                    <Button Content="❓ Help" 
                            Style="{StaticResource MenuButtonStyle}"
                            Click="Help_Click"
                            ToolTip="Show mathematics functions help and documentation"/>

                    <Button Content="ℹ️ About" 
                            Style="{StaticResource MenuButtonStyle}"
                            Click="About_Click"
                            ToolTip="About mathematics functions"/>

                </StackPanel>
            </Grid>
        </Border>
        <!-- #endregion -->

        <!-- #region Main Content Area -->
        <ScrollViewer Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto" 
                      HorizontalScrollBarVisibility="Auto"
                      Background="White"
                      Padding="0"
                      BorderThickness="0">

            <!-- Mathematics Panel Container -->
            <Border Background="#F8F9FA" 
                    BorderThickness="0" 
                    Padding="5">

                <!-- THIS IS THE KEY: Contains the MathematicsPanel -->
                <local:MathematicsPanel x:Name="MathPanel" 
                                       Margin="5" Loaded="MathPanel_Loaded"/>
            </Border>
        </ScrollViewer>
        <!-- #endregion -->

        <!-- #region Status Bar -->
        <StatusBar Grid.Row="2" Style="{StaticResource StatusBarStyle}">
            <StatusBar.ItemsPanel>
                <ItemsPanelTemplate>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <!-- Status Icon -->
                            <ColumnDefinition Width="*"/>
                            <!-- Status Text -->
                            <ColumnDefinition Width="Auto"/>
                            <!-- Separator -->
                            <ColumnDefinition Width="Auto"/>
                            <!-- Connection Status -->
                            <ColumnDefinition Width="Auto"/>
                            <!-- Separator -->
                            <ColumnDefinition Width="200"/>
                            <!-- Timestamp -->
                        </Grid.ColumnDefinitions>
                    </Grid>
                </ItemsPanelTemplate>
            </StatusBar.ItemsPanel>

            <!-- Status Icon -->
            <StatusBarItem Grid.Column="0">
                <TextBlock x:Name="StatusIcon" 
                          Text="🧮" 
                          FontSize="14" 
                          Foreground="White" 
                          Margin="10,0,5,0"
                          VerticalAlignment="Center"/>
            </StatusBarItem>

            <!-- Main Status Text -->
            <StatusBarItem Grid.Column="1">
                <TextBlock x:Name="StatusText" 
                          Text="Ready - Mathematics functions initialized" 
                          Style="{StaticResource StatusTextStyle}"/>
            </StatusBarItem>

            <!-- Separator -->
            <StatusBarItem Grid.Column="2">
                <Separator Style="{StaticResource SeparatorStyle}"/>
            </StatusBarItem>

            <!-- Connection Status -->
            <StatusBarItem Grid.Column="3">
                <StackPanel Orientation="Horizontal">
                    <Ellipse x:Name="ConnectionIndicator" 
                             Width="8" Height="8" 
                             Fill="#FF5722" 
                             Margin="5,0"
                             VerticalAlignment="Center"
                             ToolTip="Oscilloscope connection status"/>
                    <TextBlock x:Name="ConnectionText" 
                               Text="Disconnected" 
                               Foreground="#FF8A65" 
                               FontSize="11" 
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"/>
                </StackPanel>
            </StatusBarItem>

            <!-- Separator -->
            <StatusBarItem Grid.Column="4">
                <Separator Style="{StaticResource SeparatorStyle}"/>
            </StatusBarItem>

            <!-- Timestamp -->
            <StatusBarItem Grid.Column="5">
                <TextBlock x:Name="TimestampText" 
                          Text="Last Updated: --:--:--" 
                          Style="{StaticResource TimestampStyle}"/>
            </StatusBarItem>
        </StatusBar>
        <!-- #endregion -->

    </Grid>
    <!-- #endregion -->

    <!-- #region Window Context Menu -->
    <Window.ContextMenu>
        <ContextMenu>
            <MenuItem Header="📁 Load Configuration..." Click="LoadConfig_Click">
                <MenuItem.Icon>
                    <TextBlock Text="📁" FontSize="12"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Header="💾 Save Configuration..." Click="SaveConfig_Click">
                <MenuItem.Icon>
                    <TextBlock Text="💾" FontSize="12"/>
                </MenuItem.Icon>
            </MenuItem>

            <Separator/>

            <MenuItem Header="⚡ Apply Preset">
                <MenuItem Header="Basic Addition" Click="ApplyPreset_BasicAddition"/>
                <MenuItem Header="FFT Analysis" Click="ApplyPreset_FFTAnalysis"/>
                <MenuItem Header="Low Pass Filter" Click="ApplyPreset_LowPassFilter"/>
                <MenuItem Header="Integration" Click="ApplyPreset_Integration"/>
            </MenuItem>

            <Separator/>

            <MenuItem Header="🔄 Reset All Settings" Click="ResetAll_Click">
                <MenuItem.Icon>
                    <TextBlock Text="🔄" FontSize="12"/>
                </MenuItem.Icon>
            </MenuItem>

            <Separator/>

            <MenuItem Header="📋 Copy SCPI Commands" Click="CopyCommands_Click">
                <MenuItem.Icon>
                    <TextBlock Text="📋" FontSize="12"/>
                </MenuItem.Icon>
            </MenuItem>

            <MenuItem Header="📊 Export Commands..." Click="ExportCommands_Click">
                <MenuItem.Icon>
                    <TextBlock Text="📊" FontSize="12"/>
                </MenuItem.Icon>
            </MenuItem>

            <Separator/>

            <MenuItem Header="❓ Help" Click="Help_Click">
                <MenuItem.Icon>
                    <TextBlock Text="❓" FontSize="12"/>
                </MenuItem.Icon>
            </MenuItem>
        </ContextMenu>
    </Window.ContextMenu>
    <!-- #endregion -->

</Window>